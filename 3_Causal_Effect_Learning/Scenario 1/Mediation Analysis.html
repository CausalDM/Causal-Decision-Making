

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Mediation Analysis &#8212; Causal Decision Making</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '3_Causal_Effect_Learning/Scenario 1/Mediation Analysis';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Markov Decision Processes – Paradigm 2" href="../Scenario%202/underMDP.html" />
    <link rel="prev" title="8. Dragon Net" href="Dragonnet.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../Overview.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Causal Decision Making - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="Causal Decision Making - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../Overview.html">
                    Overview
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Motivating Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../0_Motivating_Examples/CSL.html">Causal Structure Learning (CSL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../0_Motivating_Examples/CEL.html">Causal Effect Learning (CEL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../0_Motivating_Examples/CPL.html">Causal Policy Learning (CPL)</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Preliminary</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../1_Preliminary/Causal%20Inference%20Preliminary.html">Causal Inference Preliminary</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Causal Structure Learning (CSL)</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../2_Causal_Structure_Learning/Preliminaries%20of%20Causal%20Graphs.html">Preliminaries of Causal Graphs</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../2_Causal_Structure_Learning/Causal%20Discovery.html">Causal Discovery</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../2_Causal_Structure_Learning/Testing-based%20Learner.html">Testing-based Learner</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2_Causal_Structure_Learning/Functional-based%20Learner.html">Functional-based Learner</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2_Causal_Structure_Learning/Score-based%20Learner.html">Score-based Learner</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../2_Causal_Structure_Learning/Causal%20Mediation%20Analysis.html">Causal Mediation Analysis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Causal Effect Learning (CEL)</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="Single%20Stage.html"><strong>Single Stage – Paradigm 1</strong></a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ATE.html">ATE Estimation</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="HTE.html">HTE Estimation</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="S-learner.html"><strong>1. S-learner</strong></a></li>


<li class="toctree-l3"><a class="reference internal" href="T-learner.html"><strong>2. T-learner</strong></a></li>


<li class="toctree-l3"><a class="reference internal" href="X-learner.html"><strong>3. X-learner</strong></a></li>


<li class="toctree-l3"><a class="reference internal" href="R-Learner.html"><strong>4. R learner</strong></a></li>


<li class="toctree-l3"><a class="reference internal" href="DR-Learner.html"><strong>5. DR-learner</strong></a></li>


<li class="toctree-l3"><a class="reference internal" href="Lp-R-Learner.html"><strong>6. Lp-R-learner</strong></a></li>


<li class="toctree-l3"><a class="reference internal" href="GRF.html"><strong>7. Generalized Random Forest</strong></a></li>


<li class="toctree-l3"><a class="reference internal" href="Dragonnet.html"><strong>8. Dragon Net</strong></a></li>


</ul>
</li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Mediation Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Scenario%202/underMDP.html">Markov Decision Processes – Paradigm 2</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Scenario%203/Panel%20Data.html">Panel Data  – Paradigm 3</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Scenario%203/DiD.html"><strong>Difference in Difference</strong></a></li>

<li class="toctree-l2"><a class="reference internal" href="../Scenario%203/Synthetic%20Control.html"><strong>Synthetic Control</strong></a></li>




<li class="toctree-l2 has-children"><a class="reference internal" href="../Scenario%203/Extensions.html">Extensions</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../Scenario%203/Matrix%20Completion.html"><strong>Matrix Completion</strong></a></li>

<li class="toctree-l3"><a class="reference internal" href="../Scenario%203/Synthetic%20DiD.html"><strong>Synthetic DiD</strong></a></li>

<li class="toctree-l3"><a class="reference internal" href="../Scenario%203/H1SL_H2SL.html"><strong>H1SL and H2SL</strong></a></li>

</ul>
</li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Causal Policy Learning (CPL)--Paradigm 1</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario1/Single%20Stage.html">Single Stage</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario1/Discrete.html">Discrete Action Space</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario1/Q-learning_Single.html">Q-Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario1/A-learning_Single.html">A-Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario1/Classification/O-Learning.html">Outcome Weighted Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario1/Quantile/QuantileOTR_test.html">Quantile Optimal Treatment Regime</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario1/Continuous.html">Continuous Action Space</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario1/Continuous/Deep%20Jump%20Learner.html">Deep Jump Learner for Continuous Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario1/Continuous/Kernel-Based%20Learner.html">Kernel-Based Learner</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario1/Continuous/Outcome%20Learning.html">Outcome Learning</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario1/PlanToDo.html">Plan To Do</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario1/Classification/E-learning.html">Entropy learning</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Causal Policy Learning (CPL)--Paradigm 2</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario2/preliminary_MDP-potential-outcome.html">Preliminary: Off-policy Evaluation and Optimization in Markov Decision Processes</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario2/Evaluation.html">Policy Evaluation–Value Estimation</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario2/FQE.html">Fitted-Q Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario2/IPW_Infinite.html">Importance Sampling for Policy Evaluation (Infinite Horizon)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario2/DR_Infinite.html">Doubly Robust Estimator for Policy Evaluation (Infinite Horizon)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario2/Deeply_Debiased.html">Deeply-Debiased Off-Policy Evaluation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario2/MediationRL.html">Policy Evaluation--Mediation Analysis</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario2/Optimization.html">Policy Optimization</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario2/FQI.html">Fitted-Q Iteration</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Causal Policy Learning (CPL)--Paradigm 3</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario3/Multi%20Stage.html">Multiple Stages (DTR)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario3/Q-learning_Multiple.html">Q-Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario3/A-learning_Multiple.html">A-Learning</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Causal Policy Learning (CPL)--Paradigm 4</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/Bandits.html">Overview: Bandits ALgorithm</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/MAB/MAB.html">Multi-Armed Bandits (MAB)</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/MAB/Epsilon_Greedy.html"><span class="math notranslate nohighlight">\(\epsilon\)</span>-Greedy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/MAB/UCB.html">UCB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/MAB/TS.html">TS</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/Contextual_Bandits/Contextual_Bandits.html">Contextual Bandits</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/Contextual_Bandits/LinUCB.html">LinUCB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/Contextual_Bandits/LinTS.html">LinTS</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/Meta_Bandits/Meta_Bandits.html">Meta Bandits</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/Meta_Bandits/Meta_TS.html">Meta Thompson Sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/Meta_Bandits/MTTS.html">Multi-Task Thompson Sampling (MTTS)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/Structured_Bandits/Structured_Bandit.html">Structured Bandit (Slate Recommendation)</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/Structured_Bandits/Cascade/Learning%20to%20rank.html">Online Learning to Rank (Cascading Bandit)</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/Structured_Bandits/Cascade/TS_Cascade.html">TS_Cascade</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/Structured_Bandits/Cascade/CascadeLinTS.html">CascadeLinTS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/Structured_Bandits/Cascade/MTSS_Cascade.html">MTSS_Cascade</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/Structured_Bandits/Combinatorial-Semi/Combinatorial%20Optimization.html">Online Combinatorial Optimization (Combinatorial Semi-Bandit)</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-16"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/Structured_Bandits/Combinatorial-Semi/CombTS.html">CombTS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/Structured_Bandits/Combinatorial-Semi/CombLinTS.html">CombLinTS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/Structured_Bandits/Combinatorial-Semi/MTSS_Comb.html">MTSS_Comb</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/Structured_Bandits/MNL/Assortment%20Optimization.html">Dynamic Assortment Optimization (Multinomial Logit Bandit)</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-17"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/Structured_Bandits/MNL/TS_MNL_Beta.html">TS_MNL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/Structured_Bandits/MNL/TS_Contextual_MNL.html">TS_Contextual_MNL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/Structured_Bandits/MNL/MTSS_MNL.html">MTSS_MNL</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/OnlineEval/Online%20Policy%20Evaluation.html">Online Policy Evaluation</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-18"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/OnlineEval/Direct%20Online%20Policy%20Evaluator.html">Direct Online Policy Evaluator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/OnlineEval/Inverse%20Probability%20Weighted%20Online%20Policy%20Evaluator.html">Inverse Probability Weighted Online Policy Evaluator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario4/OnlineEval/Doubly%20Robust%20Online%20Policy%20Evaluator.html">Doubly Robust Online Policy Evaluator</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Causal Policy Learning (CPL)--Paradigm 5</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario5/OnlineRL_Markov.html">Ooline Policy Learning and Evaluation in Markovian Environments</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Causal Policy Learning (CPL)--Paradigm 6</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../4_Causal_Policy_Learning/Scenario6/OnlineRL_non_Markov.html">Ooline Policy Learning in Non-Markovian Environments</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Case Studies</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../5_Case_Study/MIMIC3/MIMIC3_intro.html">Mimic3</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-19"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../5_Case_Study/MIMIC3/MIMIC3-Demo-Ver2.html">Mimic3 Demo-Ver2</a></li>


<li class="toctree-l2"><a class="reference internal" href="../../5_Case_Study/MIMIC3/Single_Stage.html">MIMIC III (Single-Stage)</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../5_Case_Study/MIMIC3/Longitudinal.html">MIMIC III (3-Stages)</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../5_Case_Study/MIMIC3/Infinite_Horizon.html">MIMIC III (Infinite Horizon)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../5_Case_Study/MovieLens/MovieLens.html">MovieLens</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2F3_Causal_Effect_Learning/Scenario 1/Mediation Analysis.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/3_Causal_Effect_Learning/Scenario 1/Mediation Analysis.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Mediation Analysis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#definitions">Definitions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#identification">Identification</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation">Estimation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#direct-estimator">1. Direct Estimator</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ipw-estimator">2. IPW Estimator</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-robust-mr-estimator">3. Multiple Robust (MR) Estimator</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-demo">Data Demo</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aurora-data">1. AURORA Data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#treatment-effect">treatment effect</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#covid19-data">2. Covid19 Data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="mediation-analysis">
<h1>Mediation Analysis<a class="headerlink" href="#mediation-analysis" title="Permalink to this heading">#</a></h1>
<p>In the context of causal effect estimation, we aim to evaluate the effect of a specific treatment <span class="math notranslate nohighlight">\(A\)</span> on the outcome <span class="math notranslate nohighlight">\(Y\)</span> of interest. However, there may exist other variables that can be influnced by treamtent, and affect the outcome at the same time. We denote these variables as the <code class="docutils literal notranslate"><span class="pre">Mediators</span></code>, denoted as <span class="math notranslate nohighlight">\(M\)</span>.</p>
<p>Let’s borrow a classical example from [4] to illustrate the necessity of mediation analysis. Researchers would like to evaluate the direct effect of a birth-control pill on the incidence of thrombosis. However, it is also known that the pill has a negative indirect effect on thrombosis by reducing the probability of pregnancy. In this example, we would want to estimate the effect of birth-control pill on thrombosis in the sense that, independent of marital status and other potential mediators that may not be accounted for in the study, in order to obtain reliable and consistent results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">display</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Users/alinaxu/Documents/CDM/CausalDM&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="s2">&quot;./images/CEL-Mediation-IID.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">Input In [1],</span> in <span class="ni">&lt;cell line: 3&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">display</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">os</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Users/alinaxu/Documents/CDM/CausalDM&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">display</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="s2">&quot;./images/CEL-Mediation-IID.png&quot;</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [WinError 3] 系统找不到指定的路径。: &#39;/Users/alinaxu/Documents/CDM/CausalDM&#39;
</pre></div>
</div>
</div>
</div>
<section id="definitions">
<h2>Definitions<a class="headerlink" href="#definitions" title="Permalink to this heading">#</a></h2>
<p>In general mediation analysis, there are two potential paths that can cause the treatment effect on the outcome:</p>
<ol class="arabic simple">
<li><p>The direct path from treament to outcome, denoted by <span class="math notranslate nohighlight">\(A\rightarrow R\)</span>;</p></li>
<li><p>The indirect path from treatment to outcome through the mediator <span class="math notranslate nohighlight">\(M\)</span>, denoted by <span class="math notranslate nohighlight">\(A\rightarrow M\rightarrow R\)</span>.</p></li>
</ol>
<p>More specifically, when adjusting the action from <span class="math notranslate nohighlight">\(A=a_0\)</span> to <span class="math notranslate nohighlight">\(A=a_1\)</span>,  we define the total effect (TE), natural direct effect (DE), and the natural indirect effect (DE) as below:</p>
<div class="amsmath math notranslate nohighlight" id="equation-ceff712a-6a6a-407b-9158-87c6626b09e6">
<span class="eqno">(45)<a class="headerlink" href="#equation-ceff712a-6a6a-407b-9158-87c6626b09e6" title="Permalink to this equation">#</a></span>\[\begin{equation}
\begin{aligned}
\text{TE}&amp;= \mathbb{E}[R|do(A=a_1)]-\mathbb{E}[R|do(A=a_0)]\\
\text{DE}&amp;= \mathbb{E}[R|do(A=a_1,M=m^{(a_0)})]-\mathbb{E}[R|do(A=a_0)]\\
\text{IE}&amp;= \mathbb{E}[R|do(A=a_0,M=m^{(a_1)})]-\mathbb{E}[R|do(A=a_0)]\\
\end{aligned}
\end{equation}\]</div>
<p>Under the potential outcome’s structure, we define <span class="math notranslate nohighlight">\(M_a\)</span> as the potential mediator when treatment <span class="math notranslate nohighlight">\(A=a\)</span>, and define <span class="math notranslate nohighlight">\(R_{a,m}\)</span> as the potential outcome/reward one would observe under <span class="math notranslate nohighlight">\((A=a, M=m)\)</span>. In some literature, the above effects can be samely written as</p>
<div class="amsmath math notranslate nohighlight" id="equation-ed1d65ee-2e37-43c5-99a5-6dda3b2d3c15">
<span class="eqno">(46)<a class="headerlink" href="#equation-ed1d65ee-2e37-43c5-99a5-6dda3b2d3c15" title="Permalink to this equation">#</a></span>\[\begin{equation}
\begin{aligned}
\text{TE}&amp;= \mathbb{E}[R_{a_1,m_{a_1}}]-\mathbb{E}[R_{a_0,m_{a_0}}]\\
\text{DE}&amp;= \mathbb{E}[R_{a_1,m_{a_0}}]-\mathbb{E}[R_{a,m_{a_0}}]\\
\text{IE}&amp;= \mathbb{E}[R_{a_1,m_{a_1}}]-\mathbb{E}[R_{a_1,m_{a_0}}]\\
\end{aligned}
\end{equation}\]</div>
</section>
<section id="identification">
<h2>Identification<a class="headerlink" href="#identification" title="Permalink to this heading">#</a></h2>
<p>Assumptions:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Consistency</span></code>: <span class="math notranslate nohighlight">\(M_a = M\)</span> when <span class="math notranslate nohighlight">\(A=a\)</span>, and <span class="math notranslate nohighlight">\(R_{a,m}=R\)</span> when <span class="math notranslate nohighlight">\(A=a, M=m\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">No</span> <span class="pre">unmeasured</span> <span class="pre">confounders</span></code> (i.e. <code class="docutils literal notranslate"><span class="pre">NUC</span></code>): <span class="math notranslate nohighlight">\(\{R_{a',m},M_a\}\perp A|X\)</span>, and <span class="math notranslate nohighlight">\(R_{a',m}\perp M|A=a,X\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Positivity</span></code>: <span class="math notranslate nohighlight">\(p(m|A,X)&gt;0\)</span> for each <span class="math notranslate nohighlight">\(m\in \mathcal{M}\)</span>, and <span class="math notranslate nohighlight">\(p(a|X)&gt;0\)</span> for each <span class="math notranslate nohighlight">\(a\in \mathcal{A}\)</span>.</p></li>
</ol>
<p>Under the above three assumptions, Imai et al. [3] proved the identifiability of <span class="math notranslate nohighlight">\(\mathbb{E}[R_{1,M_0}]\)</span> and <span class="math notranslate nohighlight">\(\mathbb{E}[R_{a,M_a}]\)</span> in binary action space, which is given by</p>
<div class="amsmath math notranslate nohighlight" id="equation-3bf35e59-e878-4091-ae03-4f7179dd24f1">
<span class="eqno">(47)<a class="headerlink" href="#equation-3bf35e59-e878-4091-ae03-4f7179dd24f1" title="Permalink to this equation">#</a></span>\[\begin{equation}
\begin{aligned}
\mathbb{E}[R_{1,M_0}] &amp;= \int\int \mathbb{E}[R|A=1,M=m,S=s]p(m|A=0,S=s)p(s) d\mu(m,s)\\
\mathbb{E}[R_{a,M_a}] &amp;= \int\int \mathbb{E}[R|A=a,M=m,S=s]p(m|A=a,S=s)p(s) d\mu(m,s)
\end{aligned}
\end{equation}\]</div>
</section>
<section id="estimation">
<h2>Estimation<a class="headerlink" href="#estimation" title="Permalink to this heading">#</a></h2>
<p>In this section, we introduce three estimators that are commonly used in mediation analysis when no unmeasured confounders (NUC) assumption holds.</p>
<section id="direct-estimator">
<h3>1. Direct Estimator<a class="headerlink" href="#direct-estimator" title="Permalink to this heading">#</a></h3>
<p>The first estimator is the direct method, which is a plug-in estimator based on the identification result above.  Since TE, DE and IE can be written as a function of <span class="math notranslate nohighlight">\(\mathbb{E}[R_{a,m_{a'}}]\)</span>, it suffice to estimate them separately for any <span class="math notranslate nohighlight">\(a, a'\in \mathcal{A}\)</span> and construct a DM estimator as below:</p>
<div class="amsmath math notranslate nohighlight" id="equation-586a3dca-2910-4236-92ee-32ffc29f00a9">
<span class="eqno">(48)<a class="headerlink" href="#equation-586a3dca-2910-4236-92ee-32ffc29f00a9" title="Permalink to this equation">#</a></span>\[\begin{equation}
\begin{aligned}
\widehat{\text{DE}}_{\text{DM}}&amp;= \frac{1}{N}\sum_{i,m} \bigg\{R(S_i,a_1,m)p(m|S_i,a_0)-R(S_i,a_0,m)p(m|S_i,a_0)\bigg\}\\
\widehat{\text{IE}}_{\text{DM}}&amp;= \frac{1}{N}\sum_{i,m} \bigg\{R(S_i,a_1,m)p(m|S_i,a_1)- R(S_i,a_1,m)p(m|S_i,a_0)\bigg\}
\end{aligned}
\end{equation}\]</div>
</section>
<section id="ipw-estimator">
<h3>2. IPW Estimator<a class="headerlink" href="#ipw-estimator" title="Permalink to this heading">#</a></h3>
<p>The second estimator in literature is named as the inverse probability weighting estimator, which is similar to the IPW estimator in ATE. Under the existence of mediators, the IPW estimators [2] of DE and IE are given by</p>
<div class="amsmath math notranslate nohighlight" id="equation-a25730ec-bf47-416c-8204-a7dbaa9a4e39">
<span class="eqno">(49)<a class="headerlink" href="#equation-a25730ec-bf47-416c-8204-a7dbaa9a4e39" title="Permalink to this equation">#</a></span>\[\begin{equation}
\begin{aligned}
\widehat{\text{DE}}_{\text{IPW}}&amp;= \frac{1}{N}\sum_{i=1}^N \bigg\{\frac{\mathbb{1}\{A_i=a_1\}\rho(S_i,A_i,M_i)}{p_a(A_i|S_i)}-\frac{\mathbb{1}\{A_i=a_0\}}{p_a(A_i|S_i)}\bigg\}\cdot R_i\\
\widehat{\text{IE}}_{\text{IPW}}&amp;= \frac{1}{N}\sum_{i=1}^N \bigg\{\frac{\mathbb{1}\{A_i=a_1\}}{p_a(A_i|S_i)}-\frac{\mathbb{1}\{A_i=a_1\}\rho(S_i,A_i,M_i)}{p_a(A_i|S_i)}\bigg\}\cdot R_i
\end{aligned}
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(\rho(S,A,M)=\frac{p(M|S,A=a_0)}{p(M|S,A)}\)</span> is the probability ratio that can adjust for the bias caused by distribution shift.</p>
</section>
<section id="multiple-robust-mr-estimator">
<h3>3. Multiple Robust (MR) Estimator<a class="headerlink" href="#multiple-robust-mr-estimator" title="Permalink to this heading">#</a></h3>
<p>The last estimator is called the multiple robust estimator, which was proposed by Tchetgen and Shpitser [5] based on the efficient influence function in semiparametric theory. The final MR estimator for DE and IE are derived as</p>
<div class="amsmath math notranslate nohighlight" id="equation-566e5f44-9fac-4231-837b-808e6f1a9f26">
<span class="eqno">(50)<a class="headerlink" href="#equation-566e5f44-9fac-4231-837b-808e6f1a9f26" title="Permalink to this equation">#</a></span>\[\begin{equation}
\begin{aligned}
\widehat{\text{DE}}_{\text{MR}}&amp;= \frac{1}{N}\sum_{i=1}^N \bigg[\frac{\mathbb{1}\{A_i=a_1\}}{p_a(A_i|S_i)}\rho(S_i,A_i,M_i)\big\{R_i-\mathbb{E}[R|S_i,A_i=1,M_i]\big\}\\
&amp;+\frac{\mathbb{1}\{A_i=a_0\}}{p_a(A_i|S_i)}\big\{\mathbb{E}[R|S_i,A_i=1,M_i]-R_i-\eta(a_1,a_0,S)+\eta(a_0,a_0,S)\big\}+\eta(a_1,a_0,S)-\eta(a_0,a_0,S)\big\}\bigg]\\
\widehat{\text{IE}}_{\text{MR}}&amp;= \frac{1}{N}\sum_{i=1}^N \bigg[\frac{\mathbb{1}\{A_i=a_1\}}{p_a(A_i|S_i)}\Big\{R_i-\eta(a_1,a_1,S)-\rho(S_i,A_i,M_i)\big\{R_i-\mathbb{E}[R|S_i,A=1,M_i]\big\}\Big\}\\
&amp;-\frac{\mathbb{1}\{A_i=a_0\}}{p_a(A_i|S_i)}\big\{\mathbb{E}[R|S_i,A=1,M_i]-\eta(a_1,a_0,S_i)\big\}+\eta(a_1,a_1,S_i)-\eta(a_1,a_0,S_i)\bigg]
\end{aligned}
\end{equation}\]</div>
</section>
</section>
<section id="data-demo">
<h2>Data Demo<a class="headerlink" href="#data-demo" title="Permalink to this heading">#</a></h2>
<section id="aurora-data">
<h3>1. AURORA Data<a class="headerlink" href="#aurora-data" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/Users/alinaxu/Documents/CDM/CausalDM&#39;</span><span class="p">)</span>
<span class="n">AURORA_CEL</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./causaldm/data/Survey_red.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">AURORA_CEL</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;Female&#39;, &#39;Age&#39;, &#39;Non-Hispanic White&#39;, &#39;Education&#39;,
       &#39;pre-trauma physical health&#39;, &#39;pre-trauma mental health&#39;,
       &#39;Chronic Perception of Severity of Stress&#39;, &#39;Neuroticism&#39;,
       &#39;Childhood trauma&#39;, &#39;pre-trauma insomnia (cont)&#39;,
       &#39;peritraumatic distress&#39;, &#39;W2 acute stress disorder&#39;, &#39;W2 ptsd&#39;,
       &#39;W2 Depression&#39;, &#39;3 month ptsd&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">AURORA_CEL</span><span class="p">[</span><span class="s1">&#39;pre-trauma insomnia (cont)&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([326., 274., 242., 187.,  98., 148., 109.,  48.,  50.,  12.]),
 array([-8.55287818, -5.75287818, -2.95287818, -0.15287818,  2.64712182,
         5.44712182,  8.24712182, 11.04712182, 13.84712182, 16.64712182,
        19.44712182]),
 &lt;BarContainer object of 10 artists&gt;)
</pre></div>
</div>
<img alt="../../_images/e03e158190c8fd19e7540ef1fc225b4e171c682eb2fd5212551cacff012709f7.png" src="../../_images/e03e158190c8fd19e7540ef1fc225b4e171c682eb2fd5212551cacff012709f7.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import related packages</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span><span class="p">;</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">GradientBoostingRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>


<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">AURORA_CEL</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">state</span> <span class="o">=</span> <span class="n">AURORA_CEL</span><span class="p">[[</span><span class="s1">&#39;Female&#39;</span><span class="p">,</span> <span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="s1">&#39;Non-Hispanic White&#39;</span><span class="p">,</span> <span class="s1">&#39;Education&#39;</span><span class="p">,</span>
       <span class="s1">&#39;pre-trauma physical health&#39;</span><span class="p">,</span> <span class="s1">&#39;pre-trauma mental health&#39;</span><span class="p">,</span>
       <span class="s1">&#39;Chronic Perception of Severity of Stress&#39;</span><span class="p">,</span> <span class="s1">&#39;Neuroticism&#39;</span><span class="p">,</span>
       <span class="s1">&#39;Childhood trauma&#39;</span><span class="p">]]</span>
<span class="n">action</span> <span class="o">=</span> <span class="n">AURORA_CEL</span><span class="p">[</span><span class="s1">&#39;pre-trauma insomnia (cont)&#39;</span><span class="p">]</span>
<span class="n">mediator</span> <span class="o">=</span> <span class="n">AURORA_CEL</span><span class="p">[[</span><span class="s1">&#39;peritraumatic distress&#39;</span><span class="p">,</span> <span class="s1">&#39;W2 acute stress disorder&#39;</span><span class="p">,</span> <span class="s1">&#39;W2 ptsd&#39;</span><span class="p">,</span>
       <span class="s1">&#39;W2 Depression&#39;</span><span class="p">]]</span>
<span class="n">reward</span> <span class="o">=</span> <span class="n">AURORA_CEL</span><span class="p">[</span><span class="s1">&#39;3 month ptsd&#39;</span><span class="p">]</span>

<span class="n">AURORA_CEL_MD</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;state&#39;</span><span class="p">:</span><span class="n">state</span><span class="p">,</span><span class="s1">&#39;action&#39;</span><span class="p">:</span><span class="n">action</span><span class="p">,</span><span class="s1">&#39;mediator&#39;</span><span class="p">:</span><span class="n">mediator</span><span class="p">,</span><span class="s1">&#39;reward&#39;</span><span class="p">:</span><span class="n">reward</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">action</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">action</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">action</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">action</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/9j/vb5nb4rd5bx0gr1q5ytx9q600000gn/T/ipykernel_35787/2568975421.py:1: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  action[np.where(action&gt;=0)[0]] = 1
/var/folders/9j/vb5nb4rd5bx0gr1q5ytx9q600000gn/T/ipykernel_35787/2568975421.py:2: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  action[np.where(action&lt;0)[0]] = 0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">causaldm.causaldm.learners.Causal_Effect_Learning.Mediation_Analysis.ME_Single</span> <span class="kn">import</span> <span class="n">ME_Single</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Control Policy</span>
<span class="k">def</span> <span class="nf">control_policy</span><span class="p">(</span><span class="n">state</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dim_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_a</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">get_a</span><span class="p">:</span>
        <span class="n">action_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">dim_state</span><span class="p">)</span>
        <span class="n">NT</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">action_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">NT</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">action</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">NT</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="n">action</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">NT</span><span class="p">)</span>
            <span class="n">action_value</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">action</span>
    <span class="k">return</span> <span class="n">action_value</span>

<span class="k">def</span> <span class="nf">target_policy</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">dim_state</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dim_state</span><span class="p">))</span>
    <span class="n">NT</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pa</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">NT</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">NT</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pa</span> <span class="o">=</span> <span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">prob_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="o">-</span><span class="n">pa</span><span class="p">,</span> <span class="n">pa</span><span class="p">])</span>
            <span class="n">action_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">prob_arr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No random for matrix input&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">action</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">action_value</span> <span class="o">=</span> <span class="n">pa</span> <span class="o">*</span> <span class="n">action</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">pa</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">action</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">action_value</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">problearner_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;splitter&quot;</span><span class="p">:[</span><span class="s2">&quot;best&quot;</span><span class="p">,</span><span class="s2">&quot;random&quot;</span><span class="p">],</span> <span class="s2">&quot;max_depth&quot;</span> <span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">50</span><span class="p">)},</span>
<span class="n">Direct_est</span> <span class="o">=</span> <span class="n">ME_Single</span><span class="p">(</span><span class="n">AURORA_CEL_MD</span><span class="p">,</span> <span class="n">r_model</span> <span class="o">=</span> <span class="s1">&#39;OLS&#39;</span><span class="p">,</span>
                     <span class="n">problearner_parameters</span> <span class="o">=</span> <span class="n">problearner_parameters</span><span class="p">,</span>
                     <span class="n">truncate</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> 
                     <span class="n">target_policy</span><span class="o">=</span><span class="n">target_policy</span><span class="p">,</span> <span class="n">control_policy</span> <span class="o">=</span> <span class="n">control_policy</span><span class="p">,</span> 
                     <span class="n">dim_state</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="n">dim_mediator</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> 
                     <span class="n">expectation_MCMC_iter</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
                     <span class="n">nature_decomp</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                     <span class="n">seed</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                     <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;Direct&#39;</span><span class="p">)</span>

<span class="n">Direct_est</span><span class="o">.</span><span class="n">estimate_DE_ME</span><span class="p">()</span>
<span class="n">Direct_est</span><span class="o">.</span><span class="n">est_DE</span><span class="p">,</span> <span class="n">Direct_est</span><span class="o">.</span><span class="n">est_ME</span><span class="p">,</span> <span class="n">Direct_est</span><span class="o">.</span><span class="n">est_TE</span><span class="p">,</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1.5699712042262648, 1.35390067425173, 2.923871878477995)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">IPW_est</span> <span class="o">=</span> <span class="n">ME_Single</span><span class="p">(</span><span class="n">AURORA_CEL_MD</span><span class="p">,</span> <span class="n">r_model</span> <span class="o">=</span> <span class="s1">&#39;OLS&#39;</span><span class="p">,</span>
                     <span class="n">problearner_parameters</span> <span class="o">=</span> <span class="n">problearner_parameters</span><span class="p">,</span>
                     <span class="n">truncate</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> 
                     <span class="n">target_policy</span><span class="o">=</span><span class="n">target_policy</span><span class="p">,</span> <span class="n">control_policy</span> <span class="o">=</span> <span class="n">control_policy</span><span class="p">,</span> 
                     <span class="n">dim_state</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="n">dim_mediator</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> 
                     <span class="n">expectation_MCMC_iter</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
                     <span class="n">nature_decomp</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                     <span class="n">seed</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                     <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;IPW&#39;</span><span class="p">)</span>

<span class="n">IPW_est</span><span class="o">.</span><span class="n">estimate_DE_ME</span><span class="p">()</span>
<span class="n">IPW_est</span><span class="o">.</span><span class="n">est_DE</span><span class="p">,</span> <span class="n">IPW_est</span><span class="o">.</span><span class="n">est_ME</span><span class="p">,</span> <span class="n">IPW_est</span><span class="o">.</span><span class="n">est_TE</span><span class="p">,</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(6.1833766092547435, 1.0830496488123182, 7.266426258067062)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Robust_est</span> <span class="o">=</span> <span class="n">ME_Single</span><span class="p">(</span><span class="n">AURORA_CEL_MD</span><span class="p">,</span> <span class="n">r_model</span> <span class="o">=</span> <span class="s1">&#39;OLS&#39;</span><span class="p">,</span>
                     <span class="n">problearner_parameters</span> <span class="o">=</span> <span class="n">problearner_parameters</span><span class="p">,</span>
                     <span class="n">truncate</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> 
                     <span class="n">target_policy</span><span class="o">=</span><span class="n">target_policy</span><span class="p">,</span> <span class="n">control_policy</span> <span class="o">=</span> <span class="n">control_policy</span><span class="p">,</span> 
                     <span class="n">dim_state</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="n">dim_mediator</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> 
                     <span class="n">expectation_MCMC_iter</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
                     <span class="n">nature_decomp</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                     <span class="n">seed</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                     <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;Robust&#39;</span><span class="p">)</span>

<span class="n">Robust_est</span><span class="o">.</span><span class="n">estimate_DE_ME</span><span class="p">()</span>
<span class="n">Robust_est</span><span class="o">.</span><span class="n">est_DE</span><span class="p">,</span> <span class="n">Robust_est</span><span class="o">.</span><span class="n">est_ME</span><span class="p">,</span> <span class="n">Robust_est</span><span class="o">.</span><span class="n">est_TE</span><span class="p">,</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1.082810672178048, 2.6367679712306544, 3.7195786434087026)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Robust_DE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Robust_IE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Robust_TE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">Robust_DE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Robust_est</span><span class="o">.</span><span class="n">est_DE</span>
<span class="n">Robust_IE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Robust_est</span><span class="o">.</span><span class="n">est_ME</span>
<span class="n">Robust_TE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Robust_est</span><span class="o">.</span><span class="n">est_TE</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">mediator_1d</span> <span class="o">=</span> <span class="n">mediator</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">AURORA_CEL_1D</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;state&#39;</span><span class="p">:</span><span class="n">state</span><span class="p">,</span><span class="s1">&#39;action&#39;</span><span class="p">:</span><span class="n">action</span><span class="p">,</span><span class="s1">&#39;mediator&#39;</span><span class="p">:</span><span class="n">mediator_1d</span><span class="p">,</span><span class="s1">&#39;reward&#39;</span><span class="p">:</span><span class="n">reward</span><span class="p">}</span>
    
    <span class="n">Robust_est</span> <span class="o">=</span> <span class="n">ME_Single</span><span class="p">(</span><span class="n">AURORA_CEL_1D</span><span class="p">,</span> <span class="n">r_model</span> <span class="o">=</span> <span class="s1">&#39;OLS&#39;</span><span class="p">,</span>
                         <span class="n">problearner_parameters</span> <span class="o">=</span> <span class="n">problearner_parameters</span><span class="p">,</span>
                         <span class="n">truncate</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> 
                         <span class="n">target_policy</span><span class="o">=</span><span class="n">target_policy</span><span class="p">,</span> <span class="n">control_policy</span> <span class="o">=</span> <span class="n">control_policy</span><span class="p">,</span> 
                         <span class="n">dim_state</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="n">dim_mediator</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
                         <span class="n">expectation_MCMC_iter</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
                         <span class="n">nature_decomp</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                         <span class="n">seed</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                         <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;Robust&#39;</span><span class="p">)</span>

    <span class="n">Robust_est</span><span class="o">.</span><span class="n">estimate_DE_ME</span><span class="p">()</span>
    <span class="n">Robust_DE</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Robust_est</span><span class="o">.</span><span class="n">est_DE</span>
    <span class="n">Robust_IE</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Robust_est</span><span class="o">.</span><span class="n">est_ME</span>
    <span class="n">Robust_TE</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Robust_est</span><span class="o">.</span><span class="n">est_TE</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Mediators_index</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Overall&quot;</span><span class="p">]</span>
<span class="n">Mediators_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mediator</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Mediators_index</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Overall&#39;, array([&#39;peritraumatic distress&#39;, &#39;W2 acute stress disorder&#39;, &#39;W2 ptsd&#39;,
       &#39;W2 Depression&#39;], dtype=object)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Mediators&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;Four mediators in Total&#39;</span><span class="p">,</span><span class="s1">&#39;peritraumatic distress&#39;</span><span class="p">,</span> <span class="s1">&#39;W2 acute stress disorder&#39;</span><span class="p">,</span> <span class="s1">&#39;W2 ptsd&#39;</span><span class="p">,</span><span class="s1">&#39;W2 Depression&#39;</span><span class="p">])</span>


<span class="n">df</span><span class="p">[</span><span class="s1">&#39;DE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Robust_DE</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;IE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Robust_IE</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Robust_TE</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mediators</th>
      <th>DE</th>
      <th>IE</th>
      <th>TE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Four mediators in Total</td>
      <td>1.083</td>
      <td>2.637</td>
      <td>3.720</td>
    </tr>
    <tr>
      <th>1</th>
      <td>peritraumatic distress</td>
      <td>3.262</td>
      <td>0.234</td>
      <td>3.496</td>
    </tr>
    <tr>
      <th>2</th>
      <td>W2 acute stress disorder</td>
      <td>1.017</td>
      <td>2.435</td>
      <td>3.452</td>
    </tr>
    <tr>
      <th>3</th>
      <td>W2 ptsd</td>
      <td>1.101</td>
      <td>2.699</td>
      <td>3.800</td>
    </tr>
    <tr>
      <th>4</th>
      <td>W2 Depression</td>
      <td>2.465</td>
      <td>0.748</td>
      <td>3.214</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="treatment-effect">
<h4>treatment effect<a class="headerlink" href="#treatment-effect" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">AURORA_CEL</span><span class="p">)</span>
<span class="c1">#userinfo_index = np.array([3,5,6,7,8,9,10])</span>
<span class="n">SandA</span> <span class="o">=</span> <span class="n">AURORA_CEL</span><span class="p">[[</span><span class="s1">&#39;Female&#39;</span><span class="p">,</span> <span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="s1">&#39;Non-Hispanic White&#39;</span><span class="p">,</span> <span class="s1">&#39;Education&#39;</span><span class="p">,</span>
       <span class="s1">&#39;pre-trauma physical health&#39;</span><span class="p">,</span> <span class="s1">&#39;pre-trauma mental health&#39;</span><span class="p">,</span>
       <span class="s1">&#39;Chronic Perception of Severity of Stress&#39;</span><span class="p">,</span> <span class="s1">&#39;Neuroticism&#39;</span><span class="p">,</span>
       <span class="s1">&#39;Childhood trauma&#39;</span><span class="p">,</span><span class="s1">&#39;pre-trauma insomnia (cont)&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SandA</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Female</th>
      <th>Age</th>
      <th>Non-Hispanic White</th>
      <th>Education</th>
      <th>pre-trauma physical health</th>
      <th>pre-trauma mental health</th>
      <th>Chronic Perception of Severity of Stress</th>
      <th>Neuroticism</th>
      <th>Childhood trauma</th>
      <th>pre-trauma insomnia (cont)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>-10.131861</td>
      <td>1</td>
      <td>-0.151941</td>
      <td>5.741954</td>
      <td>0.476881</td>
      <td>3.776439</td>
      <td>7.879518</td>
      <td>-2.062249</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>13.868139</td>
      <td>0</td>
      <td>2.848059</td>
      <td>6.081954</td>
      <td>1.706881</td>
      <td>-1.223561</td>
      <td>6.879518</td>
      <td>11.937751</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>-11.131861</td>
      <td>1</td>
      <td>2.848059</td>
      <td>-2.718046</td>
      <td>-16.393119</td>
      <td>3.776439</td>
      <td>14.879518</td>
      <td>16.937751</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>15.868139</td>
      <td>0</td>
      <td>5.848059</td>
      <td>-28.418046</td>
      <td>-21.323119</td>
      <td>3.776439</td>
      <td>13.879518</td>
      <td>0.937751</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>22.868139</td>
      <td>1</td>
      <td>-5.151941</td>
      <td>0.241954</td>
      <td>-4.483119</td>
      <td>3.776439</td>
      <td>8.879518</td>
      <td>-9.062249</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1489</th>
      <td>1</td>
      <td>-15.131861</td>
      <td>1</td>
      <td>-2.151941</td>
      <td>2.641954</td>
      <td>3.506881</td>
      <td>1.776439</td>
      <td>-7.120482</td>
      <td>-9.062249</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1490</th>
      <td>0</td>
      <td>22.868139</td>
      <td>0</td>
      <td>2.848059</td>
      <td>4.321954</td>
      <td>4.656881</td>
      <td>-3.223561</td>
      <td>-12.120482</td>
      <td>13.937751</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1491</th>
      <td>1</td>
      <td>-4.131861</td>
      <td>1</td>
      <td>-2.151941</td>
      <td>7.841954</td>
      <td>9.146881</td>
      <td>-3.223561</td>
      <td>-13.120482</td>
      <td>-9.062249</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1492</th>
      <td>0</td>
      <td>-5.131861</td>
      <td>0</td>
      <td>-2.151941</td>
      <td>5.231954</td>
      <td>7.216881</td>
      <td>-0.223561</td>
      <td>2.879518</td>
      <td>-9.062249</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1493</th>
      <td>0</td>
      <td>-14.131861</td>
      <td>1</td>
      <td>-2.151941</td>
      <td>7.441954</td>
      <td>-2.333119</td>
      <td>1.776439</td>
      <td>4.879518</td>
      <td>-9.062249</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>1494 rows × 10 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># S-learner</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">S_learner</span> <span class="o">=</span> <span class="n">GradientBoostingRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">S_learner</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">SandA</span><span class="p">,</span> <span class="n">reward</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GradientBoostingRegressor(max_depth=5)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SandA_all1</span> <span class="o">=</span> <span class="n">SandA</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">SandA_all0</span> <span class="o">=</span> <span class="n">SandA</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">SandA_all1</span><span class="p">[</span><span class="s1">&#39;pre-trauma insomnia (cont)&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">SandA_all0</span><span class="p">[</span><span class="s1">&#39;pre-trauma insomnia (cont)&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="n">ATE_DM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">S_learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">SandA_all1</span><span class="p">)</span> <span class="o">-</span> <span class="n">S_learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">SandA_all0</span><span class="p">))</span><span class="o">/</span><span class="n">n</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ATE_DM</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.3238214724070896
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># propensity score model fitting</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="n">ps_model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
<span class="n">ps_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">state</span><span class="p">,</span>  <span class="n">action</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LogisticRegression()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pi_S</span> <span class="o">=</span> <span class="n">ps_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
<span class="n">ATE_IS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">action</span><span class="o">/</span><span class="n">pi_S</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">action</span><span class="p">)</span><span class="o">/</span><span class="n">pi_S</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">reward</span><span class="p">)</span><span class="o">/</span><span class="n">n</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ATE_IS</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.583008488326464
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">action</span><span class="o">*</span><span class="p">(</span><span class="n">reward</span><span class="o">-</span><span class="n">S_learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">SandA_all1</span><span class="p">))</span><span class="o">/</span><span class="n">pi_S</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">action</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">reward</span><span class="o">-</span><span class="n">S_learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">SandA_all0</span><span class="p">))</span><span class="o">/</span><span class="n">pi_S</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">n</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6766993378439592
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># combine the DM estimator and IS estimator</span>
<span class="n">ATE_DR</span> <span class="o">=</span> <span class="n">ATE_DM</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">action</span><span class="o">*</span><span class="p">(</span><span class="n">reward</span><span class="o">-</span><span class="n">S_learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">SandA_all1</span><span class="p">))</span><span class="o">/</span><span class="n">pi_S</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">action</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">reward</span><span class="o">-</span><span class="n">S_learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">SandA_all0</span><span class="p">))</span><span class="o">/</span><span class="n">pi_S</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">n</span>
<span class="n">ATE_DR</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.0005208102510488
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># mediation effect</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DE&#39;</span><span class="p">,</span><span class="s1">&#39;IE&#39;</span><span class="p">,</span><span class="s1">&#39;TE&#39;</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;four mediators in total&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">Robust_est</span><span class="o">.</span><span class="n">est_DE</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">Robust_est</span><span class="o">.</span><span class="n">est_ME</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">Robust_est</span><span class="o">.</span><span class="n">est_TE</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DE</th>
      <th>IE</th>
      <th>TE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>four mediators in total</th>
      <td>1.083</td>
      <td>2.636768</td>
      <td>3.719579</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># treatment effect</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DM&#39;</span><span class="p">,</span><span class="s1">&#39;IS&#39;</span><span class="p">,</span><span class="s1">&#39;DR&#39;</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;treatment effect&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">ATE_DM</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">ATE_IS</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">ATE_DR</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DM</th>
      <th>IS</th>
      <th>DR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>treatment effect</th>
      <td>2.324</td>
      <td>3.583</td>
      <td>3.001</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="covid19-data">
<h3>2. Covid19 Data<a class="headerlink" href="#covid19-data" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">Covid19_CEL</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./causaldm/data/covid19.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Covid19_CEL</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>Shenzhen</th>
      <th>Guangzhou</th>
      <th>Beijing</th>
      <th>Chengdu</th>
      <th>Shanghai</th>
      <th>Dongguan</th>
      <th>Suzhou</th>
      <th>Xian</th>
      <th>Hangzhou</th>
      <th>...</th>
      <th>Shangqiu</th>
      <th>Yueyang</th>
      <th>Zhumadian</th>
      <th>Changde</th>
      <th>Nanyang</th>
      <th>Yichun</th>
      <th>Xinyang</th>
      <th>Anqing</th>
      <th>Jiujiang</th>
      <th>Y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>12.292852</td>
      <td>14.637413</td>
      <td>11.913318</td>
      <td>9.513904</td>
      <td>9.951952</td>
      <td>10.795226</td>
      <td>8.010544</td>
      <td>7.147116</td>
      <td>7.071851</td>
      <td>...</td>
      <td>1.266743</td>
      <td>1.045451</td>
      <td>1.026626</td>
      <td>0.794902</td>
      <td>1.157263</td>
      <td>1.012273</td>
      <td>0.940021</td>
      <td>0.693004</td>
      <td>0.797915</td>
      <td>0.500000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>11.427091</td>
      <td>13.792291</td>
      <td>11.098134</td>
      <td>9.176879</td>
      <td>9.740606</td>
      <td>10.069790</td>
      <td>8.111048</td>
      <td>6.927152</td>
      <td>6.917465</td>
      <td>...</td>
      <td>1.264442</td>
      <td>1.065442</td>
      <td>1.042891</td>
      <td>0.762210</td>
      <td>1.123276</td>
      <td>0.971190</td>
      <td>0.944849</td>
      <td>0.717563</td>
      <td>0.782914</td>
      <td>1.095238</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>10.760591</td>
      <td>13.172900</td>
      <td>10.868353</td>
      <td>8.536234</td>
      <td>9.939283</td>
      <td>10.098691</td>
      <td>8.088660</td>
      <td>6.262078</td>
      <td>6.735539</td>
      <td>...</td>
      <td>1.208682</td>
      <td>0.955573</td>
      <td>1.069427</td>
      <td>0.698803</td>
      <td>1.084979</td>
      <td>0.902696</td>
      <td>0.899230</td>
      <td>0.633096</td>
      <td>0.769921</td>
      <td>0.477273</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>12.454398</td>
      <td>14.250654</td>
      <td>11.939562</td>
      <td>9.149566</td>
      <td>10.784729</td>
      <td>11.779052</td>
      <td>8.719391</td>
      <td>6.173107</td>
      <td>7.448533</td>
      <td>...</td>
      <td>1.226761</td>
      <td>0.964872</td>
      <td>1.125997</td>
      <td>0.729486</td>
      <td>1.135069</td>
      <td>0.921326</td>
      <td>0.925182</td>
      <td>0.662126</td>
      <td>0.828047</td>
      <td>1.400000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>15.140390</td>
      <td>16.108600</td>
      <td>13.047156</td>
      <td>9.815548</td>
      <td>11.533363</td>
      <td>15.173536</td>
      <td>9.308488</td>
      <td>6.199351</td>
      <td>7.838208</td>
      <td>...</td>
      <td>1.107659</td>
      <td>0.944363</td>
      <td>1.028927</td>
      <td>0.715424</td>
      <td>1.018883</td>
      <td>0.925700</td>
      <td>0.820400</td>
      <td>0.639058</td>
      <td>0.878947</td>
      <td>0.807692</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0</td>
      <td>18.062158</td>
      <td>17.586850</td>
      <td>14.469484</td>
      <td>10.326334</td>
      <td>13.479242</td>
      <td>17.650710</td>
      <td>10.264352</td>
      <td>6.682694</td>
      <td>8.736854</td>
      <td>...</td>
      <td>1.204114</td>
      <td>1.037254</td>
      <td>1.075291</td>
      <td>0.779771</td>
      <td>1.060582</td>
      <td>1.021507</td>
      <td>0.796522</td>
      <td>0.680173</td>
      <td>0.951977</td>
      <td>0.294326</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0</td>
      <td>24.530267</td>
      <td>20.571570</td>
      <td>17.428835</td>
      <td>12.473093</td>
      <td>17.179841</td>
      <td>21.077723</td>
      <td>12.149741</td>
      <td>7.637036</td>
      <td>10.281233</td>
      <td>...</td>
      <td>1.204114</td>
      <td>1.046941</td>
      <td>1.168571</td>
      <td>0.811361</td>
      <td>1.052676</td>
      <td>0.972389</td>
      <td>0.864756</td>
      <td>0.701395</td>
      <td>0.995490</td>
      <td>0.109589</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0</td>
      <td>25.897320</td>
      <td>19.382069</td>
      <td>17.289806</td>
      <td>13.041032</td>
      <td>17.683110</td>
      <td>21.672166</td>
      <td>13.529203</td>
      <td>7.909618</td>
      <td>10.029841</td>
      <td>...</td>
      <td>1.250219</td>
      <td>1.108112</td>
      <td>1.210270</td>
      <td>0.863557</td>
      <td>1.155546</td>
      <td>1.055981</td>
      <td>1.000739</td>
      <td>0.749153</td>
      <td>0.995393</td>
      <td>0.192593</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0</td>
      <td>25.482535</td>
      <td>19.164017</td>
      <td>19.656821</td>
      <td>14.651928</td>
      <td>18.708246</td>
      <td>19.588910</td>
      <td>14.148011</td>
      <td>8.490420</td>
      <td>10.440770</td>
      <td>...</td>
      <td>1.347127</td>
      <td>1.144951</td>
      <td>1.270242</td>
      <td>0.921650</td>
      <td>1.215292</td>
      <td>1.102442</td>
      <td>0.982433</td>
      <td>0.801220</td>
      <td>1.037740</td>
      <td>0.287785</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0</td>
      <td>27.171677</td>
      <td>22.030898</td>
      <td>23.854759</td>
      <td>19.128409</td>
      <td>22.576126</td>
      <td>18.770616</td>
      <td>16.191284</td>
      <td>10.435813</td>
      <td>12.084196</td>
      <td>...</td>
      <td>1.605906</td>
      <td>1.307340</td>
      <td>1.474589</td>
      <td>1.099494</td>
      <td>1.373177</td>
      <td>1.253232</td>
      <td>1.124960</td>
      <td>0.867672</td>
      <td>1.146863</td>
      <td>0.136656</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0</td>
      <td>21.894203</td>
      <td>19.635793</td>
      <td>23.820545</td>
      <td>20.845285</td>
      <td>21.278246</td>
      <td>12.950636</td>
      <td>14.930212</td>
      <td>11.173367</td>
      <td>10.965229</td>
      <td>...</td>
      <td>1.370520</td>
      <td>1.184868</td>
      <td>1.296518</td>
      <td>1.052125</td>
      <td>1.178420</td>
      <td>1.140642</td>
      <td>1.001873</td>
      <td>0.828338</td>
      <td>1.050149</td>
      <td>0.080622</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0</td>
      <td>17.782546</td>
      <td>17.214282</td>
      <td>23.914472</td>
      <td>22.644101</td>
      <td>19.630285</td>
      <td>8.992847</td>
      <td>12.822527</td>
      <td>12.474421</td>
      <td>10.188018</td>
      <td>...</td>
      <td>1.345831</td>
      <td>1.115597</td>
      <td>1.228738</td>
      <td>0.996008</td>
      <td>1.097064</td>
      <td>0.981428</td>
      <td>0.926802</td>
      <td>0.829375</td>
      <td>0.990533</td>
      <td>-0.013089</td>
    </tr>
    <tr>
      <th>12</th>
      <td>1</td>
      <td>13.192243</td>
      <td>13.280890</td>
      <td>18.643705</td>
      <td>18.702932</td>
      <td>17.017906</td>
      <td>6.253913</td>
      <td>9.882940</td>
      <td>11.059254</td>
      <td>7.509737</td>
      <td>...</td>
      <td>1.164002</td>
      <td>0.993222</td>
      <td>0.934286</td>
      <td>0.946955</td>
      <td>0.993287</td>
      <td>0.844765</td>
      <td>0.716947</td>
      <td>0.736582</td>
      <td>0.871981</td>
      <td>-0.112732</td>
    </tr>
    <tr>
      <th>13</th>
      <td>1</td>
      <td>5.649070</td>
      <td>6.621102</td>
      <td>8.116686</td>
      <td>9.858802</td>
      <td>7.429514</td>
      <td>2.851297</td>
      <td>4.776376</td>
      <td>5.181538</td>
      <td>3.740580</td>
      <td>...</td>
      <td>0.935064</td>
      <td>0.719345</td>
      <td>0.759164</td>
      <td>0.641585</td>
      <td>0.651791</td>
      <td>0.540918</td>
      <td>0.933250</td>
      <td>0.507287</td>
      <td>0.469476</td>
      <td>0.082212</td>
    </tr>
    <tr>
      <th>14</th>
      <td>1</td>
      <td>3.603982</td>
      <td>4.724633</td>
      <td>5.303232</td>
      <td>7.312939</td>
      <td>4.179535</td>
      <td>1.980677</td>
      <td>3.236501</td>
      <td>3.528457</td>
      <td>2.656411</td>
      <td>...</td>
      <td>1.327752</td>
      <td>1.076134</td>
      <td>1.299791</td>
      <td>0.936846</td>
      <td>1.181952</td>
      <td>0.839581</td>
      <td>1.539065</td>
      <td>0.909695</td>
      <td>0.693490</td>
      <td>0.226519</td>
    </tr>
    <tr>
      <th>15</th>
      <td>1</td>
      <td>2.528723</td>
      <td>3.417358</td>
      <td>3.668425</td>
      <td>5.043352</td>
      <td>2.848219</td>
      <td>1.364526</td>
      <td>2.062001</td>
      <td>2.410301</td>
      <td>1.871230</td>
      <td>...</td>
      <td>1.475528</td>
      <td>1.144627</td>
      <td>1.231135</td>
      <td>1.126969</td>
      <td>1.357398</td>
      <td>0.983761</td>
      <td>1.193422</td>
      <td>1.097615</td>
      <td>0.838285</td>
      <td>-0.171171</td>
    </tr>
    <tr>
      <th>16</th>
      <td>1</td>
      <td>1.876705</td>
      <td>2.463145</td>
      <td>2.434180</td>
      <td>3.511868</td>
      <td>1.921547</td>
      <td>1.050862</td>
      <td>1.366664</td>
      <td>1.753326</td>
      <td>1.281971</td>
      <td>...</td>
      <td>1.309997</td>
      <td>0.980845</td>
      <td>1.002650</td>
      <td>1.022058</td>
      <td>1.032005</td>
      <td>0.805918</td>
      <td>1.060452</td>
      <td>1.125673</td>
      <td>0.747338</td>
      <td>-0.035326</td>
    </tr>
    <tr>
      <th>17</th>
      <td>1</td>
      <td>1.606716</td>
      <td>1.988680</td>
      <td>1.813622</td>
      <td>2.686867</td>
      <td>1.432760</td>
      <td>0.928552</td>
      <td>1.074092</td>
      <td>1.395144</td>
      <td>0.947214</td>
      <td>...</td>
      <td>1.112098</td>
      <td>0.881150</td>
      <td>0.896476</td>
      <td>1.002845</td>
      <td>0.916207</td>
      <td>0.701719</td>
      <td>0.867089</td>
      <td>0.964613</td>
      <td>0.667084</td>
      <td>-0.028169</td>
    </tr>
    <tr>
      <th>18</th>
      <td>1</td>
      <td>1.524647</td>
      <td>1.808017</td>
      <td>1.606230</td>
      <td>2.339734</td>
      <td>1.215940</td>
      <td>0.950746</td>
      <td>0.921715</td>
      <td>1.220864</td>
      <td>0.834689</td>
      <td>...</td>
      <td>1.039230</td>
      <td>0.792536</td>
      <td>0.855976</td>
      <td>0.924145</td>
      <td>0.838933</td>
      <td>0.679882</td>
      <td>0.776855</td>
      <td>0.864724</td>
      <td>0.625158</td>
      <td>-0.194203</td>
    </tr>
    <tr>
      <th>19</th>
      <td>1</td>
      <td>1.376806</td>
      <td>1.638014</td>
      <td>1.428127</td>
      <td>1.903468</td>
      <td>1.053162</td>
      <td>0.893333</td>
      <td>0.826913</td>
      <td>1.059934</td>
      <td>0.711601</td>
      <td>...</td>
      <td>0.905191</td>
      <td>0.597521</td>
      <td>0.799891</td>
      <td>0.754369</td>
      <td>0.733082</td>
      <td>0.605912</td>
      <td>0.650462</td>
      <td>0.715133</td>
      <td>0.540011</td>
      <td>-0.086331</td>
    </tr>
    <tr>
      <th>20</th>
      <td>1</td>
      <td>1.324318</td>
      <td>1.604902</td>
      <td>1.240240</td>
      <td>1.678514</td>
      <td>0.941771</td>
      <td>0.853870</td>
      <td>0.713999</td>
      <td>0.979322</td>
      <td>0.616151</td>
      <td>...</td>
      <td>0.712055</td>
      <td>0.463547</td>
      <td>0.557215</td>
      <td>0.588222</td>
      <td>0.473332</td>
      <td>0.490730</td>
      <td>0.426028</td>
      <td>0.610805</td>
      <td>0.424375</td>
      <td>-0.129921</td>
    </tr>
    <tr>
      <th>21</th>
      <td>1</td>
      <td>1.425470</td>
      <td>1.787702</td>
      <td>1.371460</td>
      <td>1.939302</td>
      <td>0.995036</td>
      <td>0.940572</td>
      <td>0.799697</td>
      <td>1.127974</td>
      <td>0.644533</td>
      <td>...</td>
      <td>0.808024</td>
      <td>0.487328</td>
      <td>0.679655</td>
      <td>0.636077</td>
      <td>0.505732</td>
      <td>0.551934</td>
      <td>0.427194</td>
      <td>0.720673</td>
      <td>0.465912</td>
      <td>-0.119910</td>
    </tr>
    <tr>
      <th>22</th>
      <td>1</td>
      <td>1.512886</td>
      <td>1.614200</td>
      <td>1.222873</td>
      <td>1.902820</td>
      <td>0.931370</td>
      <td>0.935323</td>
      <td>0.742122</td>
      <td>1.076328</td>
      <td>0.511175</td>
      <td>...</td>
      <td>0.659210</td>
      <td>0.398034</td>
      <td>0.508583</td>
      <td>0.481010</td>
      <td>0.334271</td>
      <td>0.442130</td>
      <td>0.314993</td>
      <td>0.574808</td>
      <td>0.323708</td>
      <td>-0.012853</td>
    </tr>
    <tr>
      <th>23</th>
      <td>1</td>
      <td>1.231297</td>
      <td>1.336565</td>
      <td>1.064632</td>
      <td>1.691572</td>
      <td>0.771898</td>
      <td>0.755795</td>
      <td>0.555790</td>
      <td>0.826524</td>
      <td>0.377654</td>
      <td>...</td>
      <td>0.463709</td>
      <td>0.298825</td>
      <td>0.384718</td>
      <td>0.390226</td>
      <td>0.231304</td>
      <td>0.293252</td>
      <td>0.237298</td>
      <td>0.407236</td>
      <td>0.208753</td>
      <td>-0.187500</td>
    </tr>
    <tr>
      <th>24</th>
      <td>1</td>
      <td>1.095703</td>
      <td>1.326748</td>
      <td>0.995069</td>
      <td>1.561226</td>
      <td>0.689310</td>
      <td>0.758128</td>
      <td>0.536836</td>
      <td>0.751842</td>
      <td>0.328633</td>
      <td>...</td>
      <td>0.442843</td>
      <td>0.317066</td>
      <td>0.344704</td>
      <td>0.432572</td>
      <td>0.222232</td>
      <td>0.263768</td>
      <td>0.236682</td>
      <td>0.413294</td>
      <td>0.201139</td>
      <td>-0.134615</td>
    </tr>
    <tr>
      <th>25</th>
      <td>1</td>
      <td>1.112065</td>
      <td>1.308668</td>
      <td>0.848588</td>
      <td>1.496653</td>
      <td>0.631476</td>
      <td>0.753268</td>
      <td>0.488916</td>
      <td>0.658012</td>
      <td>0.287518</td>
      <td>...</td>
      <td>0.452855</td>
      <td>0.368485</td>
      <td>0.305532</td>
      <td>0.549990</td>
      <td>0.226249</td>
      <td>0.283597</td>
      <td>0.255247</td>
      <td>0.420746</td>
      <td>0.231887</td>
      <td>-0.174074</td>
    </tr>
    <tr>
      <th>26</th>
      <td>1</td>
      <td>1.123373</td>
      <td>1.341781</td>
      <td>0.936619</td>
      <td>1.448701</td>
      <td>0.607144</td>
      <td>0.780030</td>
      <td>0.488851</td>
      <td>0.602057</td>
      <td>0.247115</td>
      <td>...</td>
      <td>0.512957</td>
      <td>0.437562</td>
      <td>0.307703</td>
      <td>0.774619</td>
      <td>0.272419</td>
      <td>0.290434</td>
      <td>0.297724</td>
      <td>0.444755</td>
      <td>0.256219</td>
      <td>-0.255605</td>
    </tr>
    <tr>
      <th>27</th>
      <td>1</td>
      <td>1.095412</td>
      <td>1.440439</td>
      <td>1.013504</td>
      <td>1.414357</td>
      <td>0.610546</td>
      <td>0.890255</td>
      <td>0.512341</td>
      <td>0.571795</td>
      <td>0.249934</td>
      <td>...</td>
      <td>0.600437</td>
      <td>0.716202</td>
      <td>0.380214</td>
      <td>1.153991</td>
      <td>0.348203</td>
      <td>0.350406</td>
      <td>0.359122</td>
      <td>0.605135</td>
      <td>0.347911</td>
      <td>-0.289157</td>
    </tr>
    <tr>
      <th>28</th>
      <td>1</td>
      <td>1.086858</td>
      <td>1.482754</td>
      <td>0.947506</td>
      <td>1.316801</td>
      <td>0.626033</td>
      <td>0.920290</td>
      <td>0.583686</td>
      <td>0.558284</td>
      <td>0.269568</td>
      <td>...</td>
      <td>0.595220</td>
      <td>1.123405</td>
      <td>0.366314</td>
      <td>1.195333</td>
      <td>0.334984</td>
      <td>0.400108</td>
      <td>0.395086</td>
      <td>0.606463</td>
      <td>0.410411</td>
      <td>-0.271186</td>
    </tr>
    <tr>
      <th>29</th>
      <td>1</td>
      <td>1.437782</td>
      <td>1.738454</td>
      <td>1.033301</td>
      <td>1.221707</td>
      <td>0.695304</td>
      <td>1.084946</td>
      <td>0.659016</td>
      <td>0.564570</td>
      <td>0.292928</td>
      <td>...</td>
      <td>0.551027</td>
      <td>0.872629</td>
      <td>0.374933</td>
      <td>0.788778</td>
      <td>0.311137</td>
      <td>0.351248</td>
      <td>0.413392</td>
      <td>0.450814</td>
      <td>0.372341</td>
      <td>-0.360465</td>
    </tr>
    <tr>
      <th>30</th>
      <td>1</td>
      <td>1.015837</td>
      <td>1.396958</td>
      <td>0.901724</td>
      <td>0.952949</td>
      <td>0.620428</td>
      <td>0.857758</td>
      <td>0.526792</td>
      <td>0.436590</td>
      <td>0.248962</td>
      <td>...</td>
      <td>0.437627</td>
      <td>0.522839</td>
      <td>0.301417</td>
      <td>0.502103</td>
      <td>0.274428</td>
      <td>0.232308</td>
      <td>0.308740</td>
      <td>0.295520</td>
      <td>0.225860</td>
      <td>-0.090909</td>
    </tr>
    <tr>
      <th>31</th>
      <td>1</td>
      <td>0.995587</td>
      <td>1.330279</td>
      <td>0.886270</td>
      <td>0.834527</td>
      <td>0.656683</td>
      <td>0.879530</td>
      <td>0.525366</td>
      <td>0.432540</td>
      <td>0.286967</td>
      <td>...</td>
      <td>0.518789</td>
      <td>0.455188</td>
      <td>0.322412</td>
      <td>0.449485</td>
      <td>0.348494</td>
      <td>0.236520</td>
      <td>0.295650</td>
      <td>0.286870</td>
      <td>0.214488</td>
      <td>-0.873563</td>
    </tr>
    <tr>
      <th>32</th>
      <td>1</td>
      <td>0.957841</td>
      <td>1.388632</td>
      <td>0.875351</td>
      <td>0.830671</td>
      <td>0.674438</td>
      <td>0.940637</td>
      <td>0.531976</td>
      <td>0.439182</td>
      <td>0.316094</td>
      <td>...</td>
      <td>0.531587</td>
      <td>0.445144</td>
      <td>0.340297</td>
      <td>0.448254</td>
      <td>0.360742</td>
      <td>0.249350</td>
      <td>0.296428</td>
      <td>0.302875</td>
      <td>0.213581</td>
      <td>-0.424242</td>
    </tr>
    <tr>
      <th>33</th>
      <td>1</td>
      <td>1.025266</td>
      <td>1.409206</td>
      <td>0.826394</td>
      <td>0.816610</td>
      <td>0.645473</td>
      <td>1.057374</td>
      <td>0.544352</td>
      <td>0.409633</td>
      <td>0.348300</td>
      <td>...</td>
      <td>0.458590</td>
      <td>0.384232</td>
      <td>0.315997</td>
      <td>0.400205</td>
      <td>0.328763</td>
      <td>0.280001</td>
      <td>0.247244</td>
      <td>0.280584</td>
      <td>0.213905</td>
      <td>-0.052632</td>
    </tr>
    <tr>
      <th>34</th>
      <td>1</td>
      <td>0.847292</td>
      <td>1.199707</td>
      <td>0.807311</td>
      <td>0.791759</td>
      <td>0.614239</td>
      <td>0.896800</td>
      <td>0.520700</td>
      <td>0.434322</td>
      <td>0.364986</td>
      <td>...</td>
      <td>0.516326</td>
      <td>0.421654</td>
      <td>0.294775</td>
      <td>0.432475</td>
      <td>0.319950</td>
      <td>0.318913</td>
      <td>0.210438</td>
      <td>0.269082</td>
      <td>0.239209</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>35</th>
      <td>1</td>
      <td>1.419055</td>
      <td>1.741241</td>
      <td>0.908431</td>
      <td>0.955282</td>
      <td>0.779803</td>
      <td>1.225012</td>
      <td>0.722066</td>
      <td>0.528898</td>
      <td>0.528379</td>
      <td>...</td>
      <td>0.663617</td>
      <td>0.538099</td>
      <td>0.322801</td>
      <td>0.482760</td>
      <td>0.354683</td>
      <td>0.398066</td>
      <td>0.240667</td>
      <td>0.335632</td>
      <td>0.288036</td>
      <td>-0.444444</td>
    </tr>
    <tr>
      <th>36</th>
      <td>1</td>
      <td>1.159110</td>
      <td>1.644332</td>
      <td>0.912514</td>
      <td>1.006085</td>
      <td>0.814860</td>
      <td>1.225400</td>
      <td>0.734929</td>
      <td>0.505570</td>
      <td>0.716072</td>
      <td>...</td>
      <td>0.881734</td>
      <td>0.582487</td>
      <td>0.436298</td>
      <td>0.607565</td>
      <td>0.509652</td>
      <td>0.551902</td>
      <td>0.411350</td>
      <td>0.418997</td>
      <td>0.459529</td>
      <td>-0.645161</td>
    </tr>
    <tr>
      <th>37</th>
      <td>1</td>
      <td>1.304294</td>
      <td>1.796126</td>
      <td>0.914522</td>
      <td>1.095768</td>
      <td>0.906228</td>
      <td>1.343434</td>
      <td>0.856688</td>
      <td>0.531166</td>
      <td>0.808380</td>
      <td>...</td>
      <td>0.997596</td>
      <td>0.624607</td>
      <td>0.522742</td>
      <td>0.600113</td>
      <td>0.597650</td>
      <td>0.659275</td>
      <td>0.439182</td>
      <td>0.439279</td>
      <td>0.510786</td>
      <td>-0.363636</td>
    </tr>
  </tbody>
</table>
<p>38 rows × 32 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import related packages</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span><span class="p">;</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">GradientBoostingRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>


<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Covid19_CEL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>38
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1">#state = np.array(Covid19_CEL[&#39;Beijing&#39;]).reshape(-1, 1)</span>
<span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Covid19_CEL</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">])</span>
<span class="n">mediator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Covid19_CEL</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
<span class="n">reward</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Covid19_CEL</span><span class="p">[</span><span class="s1">&#39;Tianjin&#39;</span><span class="p">])</span>
<span class="n">MovieLens_CEL_MD</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;state&#39;</span><span class="p">:</span><span class="n">state</span><span class="p">,</span><span class="s1">&#39;action&#39;</span><span class="p">:</span><span class="n">action</span><span class="p">,</span><span class="s1">&#39;mediator&#39;</span><span class="p">:</span><span class="n">mediator</span><span class="p">,</span><span class="s1">&#39;reward&#39;</span><span class="p">:</span><span class="n">reward</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">causaldm.causaldm.learners.Causal_Effect_Learning.Mediation_Analysis.ME_Single</span> <span class="kn">import</span> <span class="n">ME_Single</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Control Policy</span>
<span class="k">def</span> <span class="nf">control_policy</span><span class="p">(</span><span class="n">state</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dim_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_a</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">get_a</span><span class="p">:</span>
        <span class="n">action_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">dim_state</span><span class="p">)</span>
        <span class="n">NT</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">action_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">NT</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">action</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">NT</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="n">action</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">NT</span><span class="p">)</span>
            <span class="n">action_value</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">action</span>
    <span class="k">return</span> <span class="n">action_value</span>

<span class="k">def</span> <span class="nf">target_policy</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">dim_state</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dim_state</span><span class="p">))</span>
    <span class="n">NT</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pa</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">NT</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">NT</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pa</span> <span class="o">=</span> <span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">prob_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="o">-</span><span class="n">pa</span><span class="p">,</span> <span class="n">pa</span><span class="p">])</span>
            <span class="n">action_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">prob_arr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No random for matrix input&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">action</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">action_value</span> <span class="o">=</span> <span class="n">pa</span> <span class="o">*</span> <span class="n">action</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">pa</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">action</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">action_value</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">problearner_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;splitter&quot;</span><span class="p">:[</span><span class="s2">&quot;best&quot;</span><span class="p">,</span><span class="s2">&quot;random&quot;</span><span class="p">],</span> <span class="s2">&quot;max_depth&quot;</span> <span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">50</span><span class="p">)},</span>
<span class="n">Direct_est</span> <span class="o">=</span> <span class="n">ME_Single</span><span class="p">(</span><span class="n">MovieLens_CEL_MD</span><span class="p">,</span> <span class="n">r_model</span> <span class="o">=</span> <span class="s1">&#39;OLS&#39;</span><span class="p">,</span>
                     <span class="n">problearner_parameters</span> <span class="o">=</span> <span class="n">problearner_parameters</span><span class="p">,</span>
                     <span class="n">truncate</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> 
                     <span class="n">target_policy</span><span class="o">=</span><span class="n">target_policy</span><span class="p">,</span> <span class="n">control_policy</span> <span class="o">=</span> <span class="n">control_policy</span><span class="p">,</span> 
                     <span class="n">dim_state</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dim_mediator</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
                     <span class="n">expectation_MCMC_iter</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
                     <span class="n">nature_decomp</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                     <span class="n">seed</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                     <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;Direct&#39;</span><span class="p">)</span>

<span class="n">Direct_est</span><span class="o">.</span><span class="n">estimate_DE_ME</span><span class="p">()</span>
<span class="n">Direct_est</span><span class="o">.</span><span class="n">est_DE</span><span class="p">,</span> <span class="n">Direct_est</span><span class="o">.</span><span class="n">est_ME</span><span class="p">,</span> <span class="n">Direct_est</span><span class="o">.</span><span class="n">est_TE</span><span class="p">,</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-4.730690894257576, 0.13369489173373478, -4.5969960025238406)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">IPW_est</span> <span class="o">=</span> <span class="n">ME_Single</span><span class="p">(</span><span class="n">MovieLens_CEL_MD</span><span class="p">,</span> <span class="n">r_model</span> <span class="o">=</span> <span class="s1">&#39;OLS&#39;</span><span class="p">,</span>
                     <span class="n">problearner_parameters</span> <span class="o">=</span> <span class="n">problearner_parameters</span><span class="p">,</span>
                     <span class="n">truncate</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> 
                     <span class="n">target_policy</span><span class="o">=</span><span class="n">target_policy</span><span class="p">,</span> <span class="n">control_policy</span> <span class="o">=</span> <span class="n">control_policy</span><span class="p">,</span> 
                     <span class="n">dim_state</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dim_mediator</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
                     <span class="n">expectation_MCMC_iter</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
                     <span class="n">nature_decomp</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                     <span class="n">seed</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                     <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;IPW&#39;</span><span class="p">)</span>

<span class="n">IPW_est</span><span class="o">.</span><span class="n">estimate_DE_ME</span><span class="p">()</span>
<span class="n">IPW_est</span><span class="o">.</span><span class="n">est_DE</span><span class="p">,</span> <span class="n">IPW_est</span><span class="o">.</span><span class="n">est_ME</span><span class="p">,</span> <span class="n">IPW_est</span><span class="o">.</span><span class="n">est_TE</span><span class="p">,</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-5.143298762540704, 0.5474864933099358, -4.595812269230768)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Robust_est</span> <span class="o">=</span> <span class="n">ME_Single</span><span class="p">(</span><span class="n">MovieLens_CEL_MD</span><span class="p">,</span> <span class="n">r_model</span> <span class="o">=</span> <span class="s1">&#39;OLS&#39;</span><span class="p">,</span>
                     <span class="n">problearner_parameters</span> <span class="o">=</span> <span class="n">problearner_parameters</span><span class="p">,</span>
                     <span class="n">truncate</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> 
                     <span class="n">target_policy</span><span class="o">=</span><span class="n">target_policy</span><span class="p">,</span> <span class="n">control_policy</span> <span class="o">=</span> <span class="n">control_policy</span><span class="p">,</span> 
                     <span class="n">dim_state</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dim_mediator</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
                     <span class="n">expectation_MCMC_iter</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
                     <span class="n">nature_decomp</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                     <span class="n">seed</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                     <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;Robust&#39;</span><span class="p">)</span>

<span class="n">Robust_est</span><span class="o">.</span><span class="n">estimate_DE_ME</span><span class="p">()</span>
<span class="n">Robust_est</span><span class="o">.</span><span class="n">est_DE</span><span class="p">,</span> <span class="n">Robust_est</span><span class="o">.</span><span class="n">est_ME</span><span class="p">,</span> <span class="n">Robust_est</span><span class="o">.</span><span class="n">est_TE</span><span class="p">,</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-4.592741884817156, -0.001726777600432909, -4.594468662417588)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Robust_DE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<span class="n">Robust_IE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<span class="n">Robust_TE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">31</span><span class="p">):</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1">#state = np.array(Covid19_CEL[&#39;Beijing&#39;]).reshape(-1, 1)</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Covid19_CEL</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">])</span>
    <span class="n">mediator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Covid19_CEL</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
    <span class="n">reward</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Covid19_CEL</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
    <span class="n">MovieLens_CEL_MD</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;state&#39;</span><span class="p">:</span><span class="n">state</span><span class="p">,</span><span class="s1">&#39;action&#39;</span><span class="p">:</span><span class="n">action</span><span class="p">,</span><span class="s1">&#39;mediator&#39;</span><span class="p">:</span><span class="n">mediator</span><span class="p">,</span><span class="s1">&#39;reward&#39;</span><span class="p">:</span><span class="n">reward</span><span class="p">}</span>
    
    <span class="n">MovieLens_CEL_MD</span>
    <span class="n">Robust_est</span> <span class="o">=</span> <span class="n">ME_Single</span><span class="p">(</span><span class="n">MovieLens_CEL_MD</span><span class="p">,</span> <span class="n">r_model</span> <span class="o">=</span> <span class="s1">&#39;OLS&#39;</span><span class="p">,</span>
                         <span class="n">problearner_parameters</span> <span class="o">=</span> <span class="n">problearner_parameters</span><span class="p">,</span>
                         <span class="n">truncate</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> 
                         <span class="n">target_policy</span><span class="o">=</span><span class="n">target_policy</span><span class="p">,</span> <span class="n">control_policy</span> <span class="o">=</span> <span class="n">control_policy</span><span class="p">,</span> 
                         <span class="n">dim_state</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dim_mediator</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
                         <span class="n">expectation_MCMC_iter</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
                         <span class="n">nature_decomp</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                         <span class="n">seed</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                         <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;Robust&#39;</span><span class="p">)</span>

    <span class="n">Robust_est</span><span class="o">.</span><span class="n">estimate_DE_ME</span><span class="p">()</span>
    <span class="n">Robust_DE</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Robust_est</span><span class="o">.</span><span class="n">est_DE</span>
    <span class="n">Robust_IE</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Robust_est</span><span class="o">.</span><span class="n">est_ME</span>
    <span class="n">Robust_TE</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Robust_est</span><span class="o">.</span><span class="n">est_TE</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Analysis of causal effects of 2020 Hubei lockdowns on reducing the COVID-19 spread in China regulated by Chinese major cities outside Hubei</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;cities&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Covid19_CEL</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">31</span><span class="p">])</span>


<span class="n">df</span><span class="p">[</span><span class="s1">&#39;DE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Robust_DE</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;IE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Robust_IE</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Robust_TE</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cities</th>
      <th>DE</th>
      <th>IE</th>
      <th>TE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Shenzhen</td>
      <td>-19.438</td>
      <td>2.918</td>
      <td>-16.521</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Guangzhou</td>
      <td>-15.709</td>
      <td>0.842</td>
      <td>-14.867</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Beijing</td>
      <td>-16.170</td>
      <td>1.922</td>
      <td>-14.248</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Chengdu</td>
      <td>-11.453</td>
      <td>1.053</td>
      <td>-10.400</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Shanghai</td>
      <td>-15.216</td>
      <td>1.969</td>
      <td>-13.247</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Dongguan</td>
      <td>-14.952</td>
      <td>1.367</td>
      <td>-13.586</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Suzhou</td>
      <td>-11.025</td>
      <td>1.037</td>
      <td>-9.989</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Xian</td>
      <td>-6.854</td>
      <td>0.235</td>
      <td>-6.619</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Hangzhou</td>
      <td>-8.516</td>
      <td>0.500</td>
      <td>-8.016</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Zhengzhou</td>
      <td>-8.311</td>
      <td>0.924</td>
      <td>-7.387</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Chongqing</td>
      <td>-3.731</td>
      <td>-0.081</td>
      <td>-3.812</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Changsha</td>
      <td>-6.421</td>
      <td>0.679</td>
      <td>-5.742</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Nanjing</td>
      <td>-5.251</td>
      <td>0.134</td>
      <td>-5.117</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Kunming</td>
      <td>-4.399</td>
      <td>0.136</td>
      <td>-4.263</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Tianjin</td>
      <td>-4.593</td>
      <td>-0.002</td>
      <td>-4.594</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Hefei</td>
      <td>-3.771</td>
      <td>0.163</td>
      <td>-3.608</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Nanning</td>
      <td>-3.629</td>
      <td>0.323</td>
      <td>-3.306</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Wenzhou</td>
      <td>-2.717</td>
      <td>-1.192</td>
      <td>-3.909</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Nanchang</td>
      <td>-2.197</td>
      <td>0.056</td>
      <td>-2.141</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Zhoukou</td>
      <td>-0.416</td>
      <td>-0.153</td>
      <td>-0.570</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Fuyang</td>
      <td>-0.485</td>
      <td>-0.058</td>
      <td>-0.543</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Shangqiu</td>
      <td>-0.408</td>
      <td>-0.104</td>
      <td>-0.512</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Yueyang</td>
      <td>-0.404</td>
      <td>-0.032</td>
      <td>-0.437</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Zhumadian</td>
      <td>-0.444</td>
      <td>-0.154</td>
      <td>-0.598</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Changde</td>
      <td>-0.165</td>
      <td>0.016</td>
      <td>-0.149</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Nanyang</td>
      <td>-0.440</td>
      <td>-0.158</td>
      <td>-0.598</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Yichun</td>
      <td>-0.473</td>
      <td>-0.062</td>
      <td>-0.536</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Xinyang</td>
      <td>-0.176</td>
      <td>-0.241</td>
      <td>-0.416</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Anqing</td>
      <td>-0.062</td>
      <td>-0.103</td>
      <td>-0.165</td>
    </tr>
    <tr>
      <th>29</th>
      <td>Jiujiang</td>
      <td>-0.493</td>
      <td>-0.017</td>
      <td>-0.510</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Hicks, Raymond and Dustin Tingley (2011). “Causal mediation analysis”. In: The Stata Journal 11.4, pp. 605–619.</p></li>
<li><p>Hong, Guanglei et al. (2010). “Ratio of mediator probability weighting for estimating natural direct and indirect effects”. In: Proceedings of the American Statistical Association, biometrics section. Alexandria, VA, USA, pp. 2401–2415.</p></li>
<li><p>Imai, Kosuke, Luke Keele, and Dustin Tingley (2010). “A general approach to causal mediation analysis.”. In: Psychological methods 15.4, p. 309.</p></li>
<li><p>Pearl, Judea (2022). “Direct and indirect effects”. In: Probabilistic and causal inference: The works of Judea Pearl, pp. 373–392.</p></li>
<li><p>Tchetgen, Eric J Tchetgen and Ilya Shpitser (2012). “Semiparametric theory for causal mediation analysis: efficiency bounds, multiple robustness, and sensitivity analysis”. In: Annals of statistics 40.3, p. 1816.</p></li>
</ol>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./3_Causal_Effect_Learning\Scenario 1"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="Dragonnet.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><strong>8. Dragon Net</strong></p>
      </div>
    </a>
    <a class="right-next"
       href="../Scenario%202/underMDP.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Markov Decision Processes – Paradigm 2</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#definitions">Definitions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#identification">Identification</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation">Estimation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#direct-estimator">1. Direct Estimator</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ipw-estimator">2. IPW Estimator</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-robust-mr-estimator">3. Multiple Robust (MR) Estimator</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-demo">Data Demo</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aurora-data">1. AURORA Data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#treatment-effect">treatment effect</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#covid19-data">2. Covid19 Data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Causal Decision Making Team
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>